window.zs=window.zs||{},window.zs.laya=window.zs.laya||{},function(e,t){"use strict";class a{constructor(){}}a.NET_XHR_RESPONSE=zs.laya.XHRUtils.NET_XHR_RESPONSE,a.APP_SHOW=zs.laya.DeviceService.EVENT_ON_SHOW,a.APP_HIDE=zs.laya.DeviceService.EVENT_ON_HIDE,a.APP_JUMP_CANCEL="NAVIGATE_FAILED",a.APP_JUMP_SUCCESS="NAVIGATE_SUCCESS",a.AD_CONFIIG_LOADED="AD_CONFIIG_LOADED",a.UI_TOAST_MESSAGE="UI_TOAST_MESSAGE",a.UI_PROGRESS_UPDATE=zs.laya.ui.LoadingBar.EVENT_UI_PROGRESS_UPDATE,a.UI_TICK_COUNT_COMPLETE=zs.laya.ui.TickCount.EVENT_UI_TICK_COUNT_COMPLETE,a.UI_VIEW_CLOSED=zs.laya.base.BaseView.EVENT_UI_VIEW_CLOSED,a.UI_VIEW_OPENED=zs.laya.base.BaseView.EVENT_UI_VIEW_OPENED,a.AD_VIDEO_PLAY="EVENT_AD_VIDEO_PLAY",a.AD_VIDEO_CLOSED="EVENT_AD_VIDEO_CLOSED",a.UI_STORE_SWITCH_TAB=zs.laya.ui.StorePage.EVENT_SWITCH_TAB,a.UI_STORE_SWITCH_ITEM=zs.laya.ui.StorePage.EVENT_SWITCH_ITEM,a.UI_STORE_ITEM_EQUIPED=zs.laya.ui.StorePage.EVENT_ITEM_EQUIPED,a.LAUNCH_COMPLETED="EVENT_LAUNCH_COMPLETED",a.DATA_SETTING_UPDATE="DATA_SETTING_UPDATE",a.DATA_LOGIN_INFO_UPDATE="DATA_LOGIN_INFO_UPDATE",a.GAME_SLEEP="GAME_SLEEP",a.GAME_WAKEUP="GAME_WAKEUP",a.GAME_HOME="GAME_HOME",a.GAME_PREPARE="GAME_PREPARE",a.GAME_START="GAME_START",a.GAME_WIN="GAME_WIN",a.GAME_FAILED="GAME_FAILED",a.GAME_RELIVE="GAME_RELIVE",a.GAME_AGAIN="GAME_AGAIN",a.GAME_OVER="GAME_OVER",a.EGG_GET_AWARD="EGG_GET_AWARD",t.ILaya.regClass(a),t.ClassUtils.regClass("zs.laya.game.EventId",a),t.ClassUtils.regClass("Zhise.EventId",a);class s{constructor(){}}s.STATE_LOADING=0,s.STATE_UNBEGIN=1,s.STATE_PREPARE=2,s.STATE_PLAYING=3,s.STATE_PAUSE=4,t.ILaya.regClass(s),t.ClassUtils.regClass("zs.laya.game.GameState",s),t.ClassUtils.regClass("Zhise.GameState",s);class i{constructor(){}static reqLoginArgs(){return this.Instance.reqLoginArgs?this.Instance.reqLoginArgs():{}}static reqUserInfoArgs(){return this.Instance.reqUserInfoArgs?this.Instance.reqUserInfoArgs():{}}static reqBaseCfgArgs(){return this.Instance.reqBaseCfgArgs?this.Instance.reqBaseCfgArgs():{}}static reqStartGameArgs(){return this.Instance.reqStartGameArgs?this.Instance.reqStartGameArgs():{}}static reqEndGameArgs(){return this.Instance.reqEndGameArgs?this.Instance.reqEndGameArgs():{}}static reqTopRankArgs(){return this.Instance.reqTopRankArgs?this.Instance.reqTopRankArgs():{}}static uploadVideoArgs(){return this.Instance.uploadVideoArgs?this.Instance.uploadVideoArgs():{}}}i.Instance={reqLoginArgs:function(){return{}},reqUserInfoArgs:function(){return{}},reqBaseCfgArgs:function(){return{}},reqStartGameArgs:function(){return{}},reqEndGameArgs:function(){return{}},reqTopRankArgs:function(){return{}},uploadVideoArgs:function(){return{}}},t.ILaya.regClass(i),t.ClassUtils.regClass("zs.laya.game.WebRequestArgs",i),t.ClassUtils.regClass("Zhise.WebRequestArgs",i);class n{constructor(){}static requestLoginByCode(e,s){var i=s||{};if(i.code=e,i.timestamp=Date.now(),this.UseWebApi)this.RequestSign?zs.laya.XHRUtils.xhrPostWithSign(this.WebApiMap.login,i,this.RequestSign):zs.laya.XHRUtils.xhrPost(this.WebApiMap.login,i),console.log(this.WebApiMap.login);else{var n=l;console.log(this.WebApiMap.login),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.login,i,{data:n.appConfig.playerInfo}])})}}static requestLoginByUserId(e,s){var i=s||{};if(i.user_id=e,i.timestamp=Date.now(),this.UseWebApi)this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.login,i,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.login,i),console.log(this.WebApiMap.login);else{var n=l;console.log(this.WebApiMap.login),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.login,i,{data:n.appConfig.defaultCfg.playerInfo}])})}}static requestAuthorize(e,s,i){var n=l,o={user_id:n.playerInfo.user_id,nickname:e,avatar:s,gender:i,timestamp:Date.now()};this.UseWebApi?(this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.authorize,o,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.authorize,o),console.log(this.WebApiMap.authorize)):(console.log(this.WebApiMap.authorize),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.authorize,o,{data:n.appConfig.defaultCfg.playerInfo}])}))}static requestBaseCfg(e){var s=e||{},i=l,n=!1;i.appConfig.configVersion&&(s.v_type=i.appConfig.configVersion,n=!0),this.UseWebApi?(this.RequestSign&&n?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.gameCfg,s,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.gameCfg,s),console.log(this.WebApiMap.gameCfg)):(console.log(this.WebApiMap.gameCfg),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.gameCfg,s,{data:i.appConfig.defaultCfg.gameSetting}])}))}static updatePlayerInfo(e){var s=l,i=e||{};i.user_id=s.playerInfo.user_id,i.timestamp=Date.now(),this.UseWebApi?(this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.updateInfo,i,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.updateInfo,i),console.log(this.WebApiMap.updateInfo)):(console.log(this.WebApiMap.updateInfo),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.updateInfo,i,{data:"success"}])}))}static startGame(e){var s=l,i=e||{};i.user_id=s.playerInfo.user_id,i.timestamp=Date.now(),this.UseWebApi?(this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.gameStart,i,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.gameStart,i),console.log(this.WebApiMap.gameStart)):(console.log(this.WebApiMap.gameStart),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.gameStart,i,{data:s.appConfig.defaultCfg.levelData}])}))}static endGame(e){var s=l,i=e||{};i.user_id=s.playerInfo.user_id,i.game_id=s.levelData.game_id,i.level_id||(i.level_id=s.playerInfo.level_id),i.gold||(i.gold=s.levelData.rewardGold?s.levelData.rewardGold:0),i.is_win=s.isWin,i.timestamp=Date.now(),this.UseWebApi?(this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.gameEnd,i,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.gameEnd,i),console.log(this.WebApiMap.gameEnd)):(console.log(this.WebApiMap.gameEnd),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.gameEnd,i,{data:{gold:100}}])}))}static requestTopRank(e){var t=e||{};t.timestamp=Date.now(),this.UseWebApi?(zs.laya.XHRUtils.xhrPost(this.WebApiMap.worldRank,t),console.log(this.WebApiMap.worldRank)):console.log(this.WebApiMap.worldRank)}static updateVideoLog(e){var s=e||{};s.user_id=l.playerInfo.user_id,s.timestamp=Date.now(),this.UseWebApi?(this.RequestSign?zs.laya.XHRUtils.xhrPostWithSignAndHeader(this.WebApiMap.logVideo,s,this.RequestSign,this.RequestHeader):zs.laya.XHRUtils.xhrPost(this.WebApiMap.logVideo,s),console.log(this.WebApiMap.logVideo)):(console.log(this.WebApiMap.logVideo),t.stage.frameOnce(1,this,function(){t.stage.event(a.NET_XHR_RESPONSE,[1,this.WebApiMap.logVideo,s,null])}))}}n.WebApiMap=null,n.RequestHeader={},n.RequestSign=null,n.UseWebApi=!1,t.ILaya.regClass(n),t.ClassUtils.regClass("zs.laya.game.WebService",n),t.ClassUtils.regClass("Zhise.WebService",n);class o extends t.Script{constructor(){super(),this.toastMsg=null,this.toastCompleted=!1,this.toastList=[]}static setOpenSound(e){this.openSound=e}static setUIResConfig(e){this.viewConfig=e}static showLoading(e){null!=this.viewConfig.loading?t.Scene.open(this.viewConfig.loading,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.loading,e)})):console.error("showLoading error")}static hideLoading(){null!=this.viewConfig.loading&&t.Scene.close(this.viewConfig.loading)}static showKnockEggView(e){null!=this.viewConfig.knockEggAd?t.Scene.open(this.viewConfig.knockEggAd,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.knockEggAd,e)})):console.error("knockEggAd error")}static hideKnockEggAd(){null!=this.viewConfig.knockEggAd&&t.Scene.close(this.viewConfig.knockEggAd)}static showHome(e){null!=this.viewConfig.home?t.Scene.open(this.viewConfig.home,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.home,e)})):console.error("showHome error")}static hideHome(){null!=this.viewConfig.home&&t.Scene.close(this.viewConfig.home)}static showRank(e){null!=this.viewConfig.rank?(t.Scene.open(this.viewConfig.rank,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.rank,e)})),t.SoundManager.playSound(this.openSound)):console.error("showRank error")}static hideRank(){null!=this.viewConfig.rank&&t.Scene.close(this.viewConfig.rank)}static showPlaying(e){null!=this.viewConfig.playing?t.Scene.open(this.viewConfig.playing,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.playing,e)})):console.error("showPlaying error")}static hidePlaying(){null!=this.viewConfig.playing&&t.Scene.close(this.viewConfig.playing)}static showRelive(e){null!=this.viewConfig.relive?(t.Scene.open(this.viewConfig.relive,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.relive,e)})),t.SoundManager.playSound(this.openSound)):console.error("showRelive error")}static hideRelive(){null!=this.viewConfig.relive&&t.Scene.close(this.viewConfig.relive)}static showRelive2(e){null!=this.viewConfig.relive2?(t.Scene.open(this.viewConfig.relive2,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.relive2,e)})),t.SoundManager.playSound(this.openSound)):console.error("showRelive error")}static hideRelive2(){null!=this.viewConfig.relive2&&t.Scene.close(this.viewConfig.relive2)}static showScore(e){null!=this.viewConfig.score?(t.Scene.open(this.viewConfig.score,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.score,e)})),t.SoundManager.playSound(this.openSound)):console.error("showScore error")}static hideScore(){null!=this.viewConfig.score&&t.Scene.close(this.viewConfig.score)}static showScore2(e){null!=this.viewConfig.score2?(t.Scene.open(this.viewConfig.score2,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.score2,e)})),t.SoundManager.playSound(this.openSound)):console.error("showScore error")}static hideScore2(){null!=this.viewConfig.score2&&t.Scene.close(this.viewConfig.score2)}static showStore(e){null!=this.viewConfig.store?(t.Scene.open(this.viewConfig.store,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.store,e)})),t.SoundManager.playSound(this.openSound)):console.error("showStore error")}static hideStore(){null!=this.viewConfig.store&&t.Scene.close(this.viewConfig.store)}static showAchieve(e){null!=this.viewConfig.achieve?(t.Scene.open(this.viewConfig.achieve,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.achieve,e)})),t.SoundManager.playSound(this.openSound)):console.error("showAchieve error")}static hideAchieve(){null!=this.viewConfig.achieve&&t.Scene.close(this.viewConfig.achieve)}static showScreenAd(e){null!=this.viewConfig.screenAd?(t.Scene.open(this.viewConfig.screenAd,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.screenAd,e)})),t.SoundManager.playSound(this.openSound)):console.error("showScreenAd error")}static hideScreenAd(){null!=this.viewConfig.screenAd&&t.Scene.close(this.viewConfig.screenAd)}static showListAd(e){null!=this.viewConfig.listAd?(t.Scene.open(this.viewConfig.listAd,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.listAd,e)})),t.SoundManager.playSound(this.openSound)):console.error("showListAd error")}static hideListAd(){null!=this.viewConfig.listAd&&t.Scene.close(this.viewConfig.listAd)}static showHomeFloatAd(e){null!=this.viewConfig.floatAd?(t.Scene.open(this.viewConfig.floatAd,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.floatAd,e)})),t.SoundManager.playSound(this.openSound)):console.error("showHomeFloatAd error")}static hideHomeFloatAd(){null!=this.viewConfig.floatAd&&t.Scene.close(this.viewConfig.floatAd)}static showGuide(e){null!=this.viewConfig.guide?t.Scene.open(this.viewConfig.guide,!1,e,t.Handler.create(this,function(t){this.initView(t,this.viewScript.guide,e)})):console.error("showGuide error")}static hideGuide(){null!=this.viewConfig.guide?t.Scene.close(this.viewConfig.guide):console.error("hideGuide error")}static showMsgBox(e){null!=this.viewConfig.msgBox?t.Scene.open(this.viewConfig.msgBox,!1,e,t.Handler.create(this,function(t){this.initView(t,zs.laya.ui.MsgBoxView,e)})):console.error("showMsgBox error")}static initView(e,t,a){if(e._gameData=a,t){var s=e.getComponent(t);null==s&&(s=e.addComponent(t)),s.initView&&s.initView(a)}}static showToast(e){this.sInstance&&this.sInstance.popToastMsg(e)}popToastMsg(e){this.toastList.push(e),null==this.toastMsg?t.loader.create("prefab/toastMsg.json",t.Handler.create(this,this.onToastPrefabReady),null,t.Loader.PREFAB):1==this.toastList.length&&this.toastCompleted&&this.popToast()}onToastPrefabReady(e){this.toastMsg=this.owner.addChild(e.create()),this.popToast()}popToast(){if(0!=this.toastList.length){this.toastCompleted=!1;var e=this.toastList.shift();this.toastMsg.visible=!0,this.toastMsg.text=e,this.toastMsg.centerY=400,this.toastMsg.zOrder=100;var a=this;t.Tween.to(this.toastMsg,{centerY:0},500,null,t.Handler.create(this,function(){a.toastCompleted=!0,t.timer.once(500,a,a.popToast)}))}else this.toastMsg.visible=!1}onAwake(){o.sInstance=this}onDestroy(){o.sInstance=null}onEnable(){t.stage.on(o.UI_TOAST_MESSAGE,this,this.popToastMsg)}onDisable(){t.stage.off(o.UI_TOAST_MESSAGE,this,this.popToastMsg)}}o.UI_TOAST_MESSAGE=a.UI_TOAST_MESSAGE,o.sInstance=null,o.openSound="sound/viewOpen.wav",o.viewConfig={},o.viewScript={},t.ILaya.regClass(o),t.ClassUtils.regClass("zs.laya.game.UIService",o),t.ClassUtils.regClass("zs.laya.game.ViewService",o),t.ClassUtils.regClass("Zhise.ViewService",o);class r{constructor(){}static enterGamePopup(){return this.Instance.enterGamePopup?this.Instance.enterGamePopup():{}}static onGameFaildPopUp(){return this.Instance.onGameFaildPopUp?this.Instance.onGameFaildPopUp():{}}static onGameWinPopUp(){return this.Instance.onGameWinPopUp?this.Instance.onGameWinPopUp():{}}static onGameOverPopUp(){return this.Instance.onGameOverPopUp?this.Instance.onGameOverPopUp():{}}static showInsertAd(){return this.Instance.showInsertAd?this.Instance.showInsertAd():{}}static onExportJumpCancel(){return this.Instance.onExportJumpCancel?this.Instance.onExportJumpCancel():{}}}r.Instance={enterGamePopup:function(){return{}},onGameFaildPopUp:function(){return{}},onGameWinPopUp:function(){return{}},onGameOverPopUp:function(){return{}},showInsertAd:function(){return{}},onExportJumpCancel:function(){return{}}},t.ILaya.regClass(r),t.ClassUtils.regClass("zs.laya.game.PlatformInterface",r),t.ClassUtils.regClass("Zhise.PlatformInterface",r);class l extends t.Script{constructor(){super(),this.configFirstReady=!1,this.loginFirstReady=!1,this.isSettingReady=!1,this.isLoginSuccess=!1,this.loginData=null,this.isWin=!1,this.isBaseSpriteReady=!1,this.default3DScene=null,this.launchResReady=!1,this.progressHandler=null}static get GameState(){return this.gameState}static set GameState(e){this.gameState=e}static get ReliveChance(){return this.reliveChance}static set ReliveChance(e){this.reliveChance=e}static get LevId(){var e=t.LocalStorage.getItem("levId");return null==e||0==e.length?0:Number(e)}static set LevId(e){t.LocalStorage.setItem("levId",e.toString())}onAwake(){zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.startupEvt),zs.laya.sdk.SdkService.initSDK(),t.stage.addComponent(zs.laya.Resource),t.stage.addComponent(zs.laya.ObjectPool),t.stage.addComponent(zs.laya.DeviceService),t.stage.addComponent(zs.laya.EffectFactory),t.stage.addComponent(o),t.stage.on(a.GAME_HOME,this,this.onGameHome),t.stage.on(a.GAME_PREPARE,this,this.onGamePrepare),t.stage.on(a.GAME_START,this,this.onGameStart),t.stage.on(a.GAME_OVER,this,this.onGameOver),t.stage.on(a.GAME_RELIVE,this,this.onGameRelive),t.stage.on(a.GAME_FAILED,this,this.onGameFailed),t.stage.on(a.GAME_WIN,this,this.onGameWin),t.stage.on(a.APP_SHOW,this,this.onGameShow),t.stage.on(a.APP_HIDE,this,this.onGameHide),t.stage.on(a.APP_JUMP_CANCEL,this,this.onJumpCancel),t.stage.on(a.NET_XHR_RESPONSE,this,this.onNetXHRResponse),t.loader.load(["config/gameCfg.json","config/publishVer.json"],t.Handler.create(this,this.onGameCfgReady)),o.viewScript={loading:zs.laya.ui.LoadingView,home:zs.laya.ui.HomeView,playing:zs.laya.base.ZhiSeView,relive:zs.laya.ui.ReliveView,relive2:zs.laya.ui.ReliveView2,score:zs.laya.ui.WinView,score2:zs.laya.ui.WinView2,rank:zs.laya.ui.RankView,msgBox:zs.laya.ui.MsgBoxView,guide:zs.laya.base.ZhiSeView,store:zs.laya.ui.StorePage,achieve:zs.laya.base.ZhiSeView}}onDestroy(){t.stage.off(a.GAME_HOME,this,this.onGameHome),t.stage.off(a.GAME_PREPARE,this,this.onGamePrepare),t.stage.off(a.GAME_START,this,this.onGameStart),t.stage.off(a.GAME_OVER,this,this.onGameOver),t.stage.off(a.GAME_RELIVE,this,this.onGameRelive),t.stage.off(a.GAME_FAILED,this,this.onGameFailed),t.stage.off(a.GAME_WIN,this,this.onGameWin),t.stage.off(a.APP_SHOW,this,this.onGameShow),t.stage.off(a.APP_HIDE,this,this.onGameHide),t.stage.off(a.APP_JUMP_CANCEL,this,this.onJumpCancel),t.stage.off(a.NET_XHR_RESPONSE,this,this.onNetXHRResponse)}onGameCfgReady(){var e=t.loader.getRes("config/gameCfg.json");l.appConfig=e,l.appConfig.version=t.loader.getRes("config/publishVer.json"),l.playerInfo=e.defaultCfg.playerInfo,l.gameSetting=e.defaultCfg.gameSetting,n.WebApiMap=l.appConfig.webApiMap,n.UseWebApi=l.appConfig.useWebApi,n.RequestSign=l.appConfig.webApiSign,o.viewConfig=e.viewMap,o.openSound=e.soundViewOpen,t.stage.once(a.UI_VIEW_OPENED,this,this.onLoadingOpened,[e.baseResList,e.fontList,e.configList]),o.showLoading(),l.appConfig.useWebAdApi&&t.loader.load(["config/platformCfg.json"],t.Handler.create(this,this.onPlatformCfgReady)),this.login()}onPlatformCfgReady(){var e=t.loader.getRes("config/platformCfg.json");zs.laya.platform.PlatformMgr.initCFG(e);zs.laya.zsapp.zsAppSdk.loadConfig(function(e){zs.laya.platform.ADConfig.initAdSetting(e),zs.laya.platform.PlatformMgr.initGameAd(),t.stage.event(zs.laya.game.EventId.AD_CONFIIG_LOADED)},function(t){console.error(t),zs.laya.platform.ADConfig.initAdSetting(e.adCfg),zs.laya.platform.PlatformMgr.initGameAd()})}onLoadingOpened(){this.progressHandler&&(this.progressHandler.recover(),this.progressHandler=null),this.loadSubpackage()}loadSubpackage(){for(;l.appConfig.subpackage&&l.appConfig.subpackage.length>0;){const e=l.appConfig.subpackage.shift();if(zs.laya.sdk.SdkService.loadSubpackage(e,null,t.Handler.create(this,this.loadSubpackage),t.Handler.create(this,this.loadSubpackage)))return}this.progressHandler&&(this.progressHandler.recover(),this.progressHandler=null),this.loadBaseConfig(),this.loadFont()}loadBaseConfig(){var e=[];l.appConfig.configList.forEach(function(t){e.push(t)}),0==e.length?this.onBaseConfigReady():(this.progressHandler=t.Handler.create(this,this.onLoadProgressUpdate,[0],!1),t.loader.load(e,t.Handler.create(this,this.onBaseConfigReady),this.progressHandler))}onBaseConfigReady(){this.progressHandler&&(this.progressHandler.recover(),this.progressHandler=null),this.loadBaseRes()}loadBaseRes(){var e=[];l.appConfig.baseResList.forEach(function(t){e.push(zs.laya.Resource.Get3dPrefabUrl(t))}),0==e.length?this.onBaseResReady():(this.progressHandler=t.Handler.create(this,this.onLoadProgressUpdate,[1],!1),t.loader.create(e,t.Handler.create(this,this.onBaseResReady),this.progressHandler))}onBaseResReady(){this.progressHandler&&(this.progressHandler.recover(),this.progressHandler=null),this.loadScene3d()}loadFont(){var e=this;l.appConfig.fontList.forEach(function(a){var s=new t.BitmapFont;s.loadFont(`font/${a}.fnt`,t.Handler.create(e,e.onFontReady,[s,a]))})}onFontReady(e,a){t.Text.registerBitmapFont(a,e)}loadScene3d(){null!=l.appConfig.default3DScene&&0!=l.appConfig.default3DScene.length?(this.progressHandler=t.Handler.create(this,this.onLoadProgressUpdate,[2],!1),zs.laya.Resource.LoadScene3dAsyn(l.appConfig.default3DScene,t.Handler.create(this,this.onLaunchResReady),this.progressHandler)):this.onLaunchResReady(null)}onLaunchResReady(e){this.progressHandler&&(this.progressHandler.recover(),this.progressHandler=null),this.launchResReady=!0,this.default3DScene=e,this.launchCompleted()}onLoadProgressUpdate(e,s){t.stage.event(a.UI_PROGRESS_UPDATE,.25*e+.25*s)}onNetXHRResponse(e,s,i,o){if(s==n.WebApiMap.login){if(1==e){l.playerInfo=l.webResponseAdatper.LoginResponse(o.data),zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.loginEvt(l.playerInfo.user_id));var r={userId:l.playerInfo.user_id,lastLoginDate:Date.now(),t:l.playerInfo.t,timestamp:l.playerInfo.timestamp};t.LocalStorage.setJSON("loginCacheData",r),this.isLoginSuccess=!0,null==l.playerInfo.level_id&&(l.playerInfo.level_id=l.LevId)}else l.playerInfo=l.appConfig.defaultCfg.playerInfo,this.isLoginSuccess=!1,null==l.playerInfo.level_id&&(l.playerInfo.level_id=l.LevId);n.RequestHeader={t:l.playerInfo.t,timestamp:l.playerInfo.timestamp},zs.laya.zsapp.zsAppSdk.init(l.playerInfo.user_id,t.Browser.onAndroid?1:0),0==this.loginFirstReady&&(this.loginFirstReady=!0,this.launchCompleted())}s==n.WebApiMap.logVideo?1==e&&zs.laya.zsapp.zsAppSdk.sendVideoLog():s==n.WebApiMap.gameCfg?(1==e?(l.gameSetting=l.webResponseAdatper.BaseCfgResponse(o.data),l.storeCfg={},o.data.ai_config&&o.data.ai_config.Shop?l.storeCfg.shopPrice=o.data.ai_config.Shop:l.storeCfg.shopPrice=[],o.data.config_list&&o.data.config_list.videoCoin?l.storeCfg.videoCoin=Number(o.data.config_list.videoCoin):l.storeCfg.videoCoin=100,this.isSettingReady=!0):this.isSettingReady=!1,t.stage.event(a.DATA_SETTING_UPDATE),0==this.configFirstReady&&(this.configFirstReady=!0,this.launchCompleted())):s==n.WebApiMap.updateInfo?1==e&&console.log("------ update info success!"):s==n.WebApiMap.gameStart?(1==e?(l.levelData=o.data,o.data.game_id&&(l.levelData.game_id=o.data.game_id)):l.levelData=l.appConfig.defaultCfg.levelData,l.gameStartRet=l.webResponseAdatper.GameStartResponse(o.data),zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.gameStartEvt(l.playerInfo.user_id,l.levelData.game_id)),t.stage.event(a.GAME_PREPARE,o.data)):s==n.WebApiMap.gameEnd&&(1==e&&(o.data.gold&&(l.playerInfo.gold=Number(o.data.gold)),this.isWin&&(l.LevId+=1,o.data.level_id?l.playerInfo.level_id=o.data.level_id:l.playerInfo.level_id=l.LevId)),this.isWin?(zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.gameOverEvt(l.playerInfo.user_id,l.levelData.game_id,"win")),zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.levelCompletedEvt(l.playerInfo.user_id,l.LevId.toString()))):zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.gameOverEvt(l.playerInfo.user_id,l.levelData.game_id,"failed")),l.gameEndRet=l.webResponseAdatper.GameEndResponse(o.data),this.reConnect(),t.stage.event(a.GAME_OVER))}onAdClosed(e){t.stage.off(a.UI_VIEW_CLOSED,this,this.onAdClosed),n.startGame(i.reqStartGameArgs())}onAdOpened(e){t.stage.off(a.UI_VIEW_OPENED,this,this.onAdOpened),t.stage.event(a.GAME_HOME)}launchCompleted(){this.launchResReady&&this.configFirstReady&&this.loginFirstReady&&(t.stage.event(a.LAUNCH_COMPLETED,this.default3DScene),r.Instance.enterGamePopup())}onGameHome(e){l.GameState=s.STATE_UNBEGIN,this.openEggTimes=0,0==l.autoStartNext?(t.stage.once(a.UI_VIEW_OPENED,this,this.onHomeOpened),o.showHome(e)):o.hideLoading()}onHomeOpened(){o.hideLoading()}onGamePrepare(e){l.GameState=s.STATE_PREPARE,l.appConfig.bgm&&zs.laya.SoundService.playMusic(l.appConfig.bgm),o.hideHome(),o.showPlaying(e)}onGameStart(){this.isWin=!1,l.autoStartNext=!1,l.GameState=s.STATE_PLAYING}onFullToFailed(e){l.GameState==s.STATE_PLAYING&&(this.isWin=!1,l.autoStartNext=!1,zs.laya.SoundService.stopMusic(),l.GameState=s.STATE_PAUSE,l.appConfig.useWebAdApi&&1==zs.laya.platform.ADConfig.zs_jump_style?o.showRelive2(e):o.showRelive(e),l.reliveChance-=1)}onFullToWin(e){l.GameState==s.STATE_PLAYING&&(this.isWin=!0,l.autoStartNext=!1,zs.laya.SoundService.stopMusic(),l.GameState=s.STATE_PAUSE,l.appConfig.useWebAdApi&&1==zs.laya.platform.ADConfig.zs_jump_style?o.showScore2(e):o.showScore(e))}isOpenExportGame(){return l.appConfig.useWebAdApi&&zs.laya.platform.ADConfig.zs_jump_switch&&zs.laya.platform.ADConfig.isPublicVersion()}onGameFailed(e){this.isOpenExportGame()&&l.appConfig.useWebAdApi&&zs.laya.platform.ADConfig.isBeforeGameAccount()?(t.stage.once(zs.laya.game.EventId.UI_VIEW_CLOSED,this,this.onFullClosed,[0,e]),r.Instance.onGameFaildPopUp()):this.onFullToFailed(e)}onFullClosed(e,t){1==e?this.onFullToWin(t):this.onFullToFailed(t)}onGameWin(e){this.isOpenExportGame()&&l.appConfig.useWebAdApi&&zs.laya.platform.ADConfig.isBeforeGameAccount()?(t.stage.once(zs.laya.game.EventId.UI_VIEW_CLOSED,this,this.onFullClosed,[1,e]),r.Instance.onGameWinPopUp()):this.onFullToWin(e)}onGameOver(){l.reliveChance=2,o.hideRelive(),o.hideRelive2(),o.hidePlaying(),o.hideScore(),o.hideScore2(),l.appConfig.useWebAdApi&&zs.laya.zsapp.zsAppSdk.loadConfig(function(e){zs.laya.platform.ADConfig.initAdSetting(e)},function(e){console.log(e)}),this.isOpenExportGame()&&zs.laya.platform.ADConfig.isBeforeGameAccount()?(t.stage.once(a.UI_VIEW_OPENED,this,this.onAdOpened),l.autoStartNext&&this.isWin&&t.stage.once(a.UI_VIEW_CLOSED,this,this.onAdClosed),r.Instance.onGameOverPopUp(),this.isWin=!1):this.onGameOverToStart()}onGameOverToStart(){t.stage.event(a.GAME_HOME),l.appConfig.useWebAdApi&&r.Instance.showInsertAd(),l.autoStartNext&&this.isWin&&n.startGame(i.reqStartGameArgs()),this.isWin=!1}onGameRelive(){l.GameState==s.STATE_PAUSE&&(l.appConfig.bgm&&zs.laya.SoundService.playMusic(l.appConfig.bgm),l.GameState=s.STATE_PLAYING,o.hideRelive(),o.hideRelive2())}onGameShow(){t.timer.scale=1,t.stage.renderingEnabled=!0,l.appConfig.bgm&&zs.laya.SoundService.playMusic(l.appConfig.bgm)}onGameHide(){t.timer.scale=0,t.stage.renderingEnabled=!1,zs.laya.SoundService.stopMusic()}onJumpCancel(){l.appConfig.useWebAdApi&&r.Instance.onExportJumpCancel()}reConnect(){0==this.isSettingReady&&n.requestBaseCfg(i.reqBaseCfgArgs()),0==this.isLoginSuccess&&this.login()}login(){n.requestBaseCfg(i.reqBaseCfgArgs());var e=t.LocalStorage.getJSON("loginCacheData");if(e&&e.lastLoginDate&&zs.laya.MiscUtils.isToday(e.lastLoginDate))return n.RequestHeader={t:e.t,timestamp:e.timestamp},void n.requestLoginByUserId(e.userId,i.reqLoginArgs());zs.laya.sdk.SdkService.login(t.Handler.create(this,function(e){e?(this.loginData=e,n.requestLoginByCode(this.loginData.identityId,i.reqLoginArgs())):n.requestLoginByUserId(l.appConfig.defaultCfg.playerInfo.user_id,i.reqLoginArgs())}),t.Handler.create(this,function(e){console.error(a.UI_TOAST_MESSAGE,e),n.requestLoginByUserId(l.appConfig.defaultCfg.playerInfo.user_id,i.reqLoginArgs())}))}}l.appConfig=null,l.playerInfo={},l.storeCfg={},l.gameSetting={},l.levelData={},l.authorizeData={},l.gameStartRet={},l.gameEndRet={},l.gameState=s.STATE_LOADING,l.reliveChance=2,l.autoStartNext=!1,l.webResponseAdatper={LoginResponse:function(e){return e},UserInfoResponse:function(e){return e},BaseCfgResponse:function(e){return e},GameStartResponse:function(e){return e},GameEndResponse:function(e){return e},TopRankResponse:function(e){return e}},t.ILaya.regClass(l),t.ClassUtils.regClass("zs.laya.game.AppMain",l),t.ClassUtils.regClass("Zhise.AppMain",l);class g extends t.Script{constructor(){super()}onAwake(){zs.laya.tdapp.tdAppSdk.event(new zs.laya.tdapp.startupEvt),zs.laya.sdk.SdkService.initSDK(),t.stage.addComponent(zs.laya.Resource),t.stage.addComponent(zs.laya.ObjectPool),t.stage.addComponent(zs.laya.DeviceService),t.stage.addComponent(zs.laya.EffectFactory),t.stage.addComponent(o),t.loader.load(["config/gameCfg.json","config/publishVer.json"],t.Handler.create(this,this.onGameCfgReady))}onGameCfgReady(){var e=t.loader.getRes("config/gameCfg.json");l.appConfig=e,l.appConfig.version=t.loader.getRes("config/publishVer.json"),l.playerInfo=e.defaultCfg.playerInfo,l.gameSetting=e.defaultCfg.gameSetting,n.WebApiMap=l.appConfig.webApiMap,n.UseWebApi=l.appConfig.useWebApi,n.RequestSign=l.appConfig.webApiSign,o.viewConfig=e.viewMap,o.openSound=e.soundViewOpen,o.viewScript={loading:zs.laya.ui.LoadingView,home:zs.laya.ui.HomeView,playing:zs.laya.base.ZhiSeView,relive:zs.laya.ui.ReliveView,score:zs.laya.ui.WinView,rank:zs.laya.ui.RankView,msgBox:zs.laya.ui.MsgBoxView,floatAd:zs.laya.platform.HomeFloatAdView,screenAd:zs.laya.platform.FullScreeAdView,knockEggAd:zs.laya.platform.KnockEggView},t.stage.once(a.UI_VIEW_OPENED,this,this.onLoadingOpened,[e.baseResList,e.fontList,e.configList]),o.showLoading(),l.appConfig.useWebAdApi&&t.loader.load(["config/platformCfg.json"],t.Handler.create(this,this.onPlatformCfgReady))}onPlatformCfgReady(){var e=t.loader.getRes("config/platformCfg.json");zs.laya.platform.PlatformMgr.initCFG(e);zs.laya.zsapp.zsAppSdk.loadConfig(function(e){zs.laya.platform.ADConfig.initAdSetting(e),zs.laya.platform.PlatformMgr.initGameAd(),t.stage.event(zs.laya.game.EventId.AD_CONFIIG_LOADED)},function(t){console.error(t),zs.laya.platform.ADConfig.initAdSetting(e.adCfg),zs.laya.platform.PlatformMgr.initGameAd()})}onLoadingOpened(e,a,s){var i=[];s.forEach(function(e){i.push(e)}),0==i.length?this.onBaseConfigReady(e,a):t.loader.load(i,t.Handler.create(this,this.onBaseConfigReady,[e,a]),t.Handler.create(this,this.onLoadProgressUpdate,[0]))}onBaseConfigReady(e,a){var s=[];e.forEach(function(e){s.push(zs.laya.Resource.Get3dPrefabUrl(e))}),0==s.length?this.onBaseResReady(l.appConfig.default3DScene):t.loader.create(s,t.Handler.create(this,this.onBaseResReady,[l.appConfig.default3DScene]),t.Handler.create(this,this.onLoadProgressUpdate,[1]));var i=this;a.forEach(function(e){var a=new t.BitmapFont;a.loadFont(`font/${e}.fnt`,t.Handler.create(i,i.onFontReady,[a,e]))})}onBaseResReady(e){null!=e&&0!=e.length?zs.laya.Resource.LoadScene3dAsyn(e,t.Handler.create(this,this.onLaunchResReady),t.Handler.create(this,this.onLoadProgressUpdate,[2])):this.onLaunchResReady(null)}onFontReady(e,a){t.Text.registerBitmapFont(a,e)}onLaunchResReady(e){t.stage.event(a.LAUNCH_COMPLETED,e)}onLoadProgressUpdate(e,a){t.stage.event(zs.laya.ui.Loading.EVENT_UI_PROGRESS_UPDATE,.5*e+.5*a)}}t.ILaya.regClass(g),t.ClassUtils.regClass("zs.laya.game.Launch",g),t.ClassUtils.regClass("Zhise.Launch",g),e.EventId=a,e.GameState=s,e.WebRequestArgs=i,e.WebService=n,e.UIService=o,e.PlatformInterface=r,e.AppMain=l,e.Launch=g}(window.zs.laya.game=window.zs.laya.game||{},Laya);